!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.OverlappingMarkerSpiderfier=t():e.OverlappingMarkerSpiderfier=t()}(this,function(){return function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="/dist/",t(0)}([function(e,t,i){e.exports=i(1)},function(e,t){/** @preserve OverlappingMarkerSpiderfier
	https://github.com/jawj/OverlappingMarkerSpiderfier
	Copyright (c) 2011 - 2013 George MacKerron
	Released under the MIT licence: http://opensource.org/licenses/mit-license
	Note: The Google Maps API v3 must be included *before* this code
	 */
var i={}.hasOwnProperty,r=[].slice;this.OverlappingMarkerSpiderfier=function(){function e(e,r){var n,s,o,a,l,u;this.map=e,null==r&&(r={});for(o in r)i.call(r,o)&&(u=r[o],this[o]=u);for(this.projHelper=new this.constructor.ProjHelper(this.map),this.initMarkerArrays(),this.listeners={},l=["click","zoom_changed","maptypeid_changed"],s=0,a=l.length;a>s;s++)n=l[s],t.addListener(this.map,n,function(e){return function(){return e.unspiderfy()}}(this));this.nudgeStackedMarkers&&t.addListenerOnce(this.map,"idle",function(e){return function(){return t.addListener(e.map,"zoom_changed",function(){return e.mapZoomChangeListener()}),e.mapZoomChangeListener()}}(this))}var t,n,s,o,a,l,u;return l=e.prototype,n=google.maps,t=n.event,a=n.MapTypeId,u=2*Math.PI,l.keepSpiderfied=!1,l.markersWontHide=!1,l.markersWontMove=!1,l.spiderfiedShadowColor="white",l.nudgeStackedMarkers=!0,l.minNudgeZoomLevel=8,l.nudgeRadius=1,l.markerCountInBaseNudgeLevel=9,l.nudgeBucketSize=12,l.nearbyDistance=20,l.circleSpiralSwitchover=9,l.circleFootSeparation=23,l.circleStartAngle=u/12,l.spiralFootSeparation=26,l.spiralLengthStart=11,l.spiralLengthFactor=4,l.spiderfiedZIndex=1e3,l.usualLegZIndex=10,l.highlightedLegZIndex=20,l.event="click",l.minZoomLevel=!1,l.lineToCenter=!0,l.legWeight=1.5,l.legColors={usual:{},highlighted:{}},o=l.legColors.usual,s=l.legColors.highlighted,o[a.HYBRID]=o[a.SATELLITE]="#fff",s[a.HYBRID]=s[a.SATELLITE]="#f00",o[a.TERRAIN]=o[a.ROADMAP]="#444",s[a.TERRAIN]=s[a.ROADMAP]="#f00",l.initMarkerArrays=function(){return this.markers=[],this.markerListenerRefs=[]},l.addMarker=function(e){var i;return null!=e._oms?this:(e._oms=!0,i=[t.addListener(e,this.event,function(t){return function(i){return t.spiderListener(e,i)}}(this))],this.markersWontHide||i.push(t.addListener(e,"visible_changed",function(t){return function(){return t.markerChangeListener(e,!1)}}(this))),this.markersWontMove||i.push(t.addListener(e,"position_changed",function(t){return function(){return t.markerChangeListener(e,!0)}}(this))),this.markerListenerRefs.push(i),this.markers.push(e),this.isNudgingActive()&&this.requestNudge(),this)},l.nudgeTimeout=null,l.requestNudge=function(){return this.nudgeTimeout&&clearTimeout(this.nudgeTimeout),this.nudgeTimeout=setTimeout(function(e){return function(){return e.nudgeAllMarkers()}}(this),10)},l.isNudgingActive=function(){return this.nudgeStackedMarkers&&!(this.minNudgeZoomLevel&&this.map.getZoom()<this.minNudgeZoomLevel)},l.markerChangeListener=function(e,t){return null==e._omsData||e._omsData.nudged||!t&&e.getVisible()||null!=this.spiderfying||null!=this.unspiderfying?void 0:this.unspiderfy(t?e:null)},l.countsPerLevel=[1,1],l.levelsByCount=[],l.getCountPerNudgeLevel=function(e){return null!=this.countsPerLevel[e]?this.countsPerLevel[e]:this.countsPerLevel[e]=this.getCountPerNudgeLevel(e-1)+Math.pow(2,e-2)*this.markerCountInBaseNudgeLevel},l.getNudgeLevel=function(e){var t;if(null!=this.levelsByCount[e])return this.levelsByCount[e];for(t=0;e>=this.countsPerLevel[t];)t+1>=this.countsPerLevel.length&&this.getCountPerNudgeLevel(t+1),t++;return this.levelsByCount[e]=t-1},l.nudgeAllMarkers=function(){var e,t,i,r,n,s,o,a,l,h,d,p,g,f,m,c,v,k,L;if(this.isNudgingActive()){for(d={},e=1/((1+this.nudgeBucketSize)*this.nudgeRadius),i=function(t){return function(t){return Math.floor(t.x*e)+","+Math.floor(t.y*e)}}(this),g=this.markers,k=[],r=n=0,s=g.length;s>n;r=++n){for(o=g[r],a=!1,h=this.llToPt(null!=(f=null!=(m=o._omsData)?m.usualPosition:void 0)?f:o.position),l={x:h.x,y:h.y};d.hasOwnProperty(i(h));)t=d[i(h)],d.hasOwnProperty(i(h))?d[i(h)]+=1:d[i(h)]=1,L=this.getNudgeLevel(t),p=20*this.nudgeRadius*L,h.x=l.x+Math.sin(u*t/this.markerCountInBaseNudgeLevel/L)*p,h.y=l.y+Math.cos(u*t/this.markerCountInBaseNudgeLevel/L)*p,this.nudged=!0,a=!0;a?(o._omsData={usualPosition:null!=(c=null!=(v=o._omsData)?v.usualPosition:void 0)?c:o.position,nudged:!0},o.setPosition(this.ptToLl(h))):null!=o._omsData&&o._omsData.nudged&&(o.setPosition(o._omsData.usualPosition),delete o._omsData),k.push(d.hasOwnProperty(i(h))?void 0:d[i(h)]=1)}return k}},l.resetNudgedMarkers=function(){var e,t,i,r;if(this.nudged){for(r=this.markers,e=0,t=r.length;t>e;e++)i=r[e],null!=i._omsData&&i._omsData.nudged&&(i.setPosition(i._omsData.usualPosition),delete i._omsData);return delete this.nudged}},l.mapZoomChangeListener=function(){return this.minNudgeZoomLevel&&this.map.getZoom()<this.minNudgeZoomLevel?this.resetNudgedMarkers():this.requestNudge()},l.getMarkers=function(){return this.markers.slice(0)},l.removeMarker=function(e){var i,r,n,s,o;if(null!=e._omsData&&this.unspiderfy(),i=this.arrIndexOf(this.markers,e),0>i)return this;for(o=this.markerListenerRefs.splice(i,1)[0],r=0,n=o.length;n>r;r++)s=o[r],t.removeListener(s);return delete e._oms,this.markers.splice(i,1),this.isNudgingActive()&&this.requestNudge(),this},l.clearMarkers=function(){var e,i,r,n,s,o,a,l,u;for(this.unspiderfy(),u=this.markers,e=i=0,n=u.length;n>i;e=++i){for(l=u[e],a=this.markerListenerRefs[e],r=0,s=a.length;s>r;r++)o=a[r],t.removeListener(o);delete l._oms}return this.initMarkerArrays(),this},l.addListener=function(e,t){var i;return(null!=(i=this.listeners)[e]?i[e]:i[e]=[]).push(t),this},l.removeListener=function(e,t){var i;return i=this.arrIndexOf(this.listeners[e],t),0>i||this.listeners[e].splice(i,1),this},l.clearListeners=function(e){return this.listeners[e]=[],this},l.trigger=function(){var e,t,i,n,s,o,a,l;for(t=arguments[0],e=arguments.length>=2?r.call(arguments,1):[],a=null!=(o=this.listeners[t])?o:[],l=[],n=0,s=a.length;s>n;n++)i=a[n],l.push(i.apply(null,e));return l},l.generatePtsCircle=function(e,t){var i,r,s,o,a,l,h,d;for(s=this.circleFootSeparation*(2+e),l=s/u,r=u/e,d=[],o=a=0,h=e;h>=0?h>a:a>h;o=h>=0?++a:--a)i=this.circleStartAngle+o*r,d.push(new n.Point(t.x+l*Math.cos(i),t.y+l*Math.sin(i)));return d},l.generatePtsSpiral=function(e,t){var i,r,s,o,a,l,h;for(o=this.spiralLengthStart,i=0,h=[],r=s=0,l=e;l>=0?l>s:s>l;r=l>=0?++s:--s)i+=this.spiralFootSeparation/o+5e-4*r,a=new n.Point(t.x+o*Math.cos(i),t.y+o*Math.sin(i)),o+=u*this.spiralLengthFactor/i,h.push(a);return h},l.spiderListener=function(e,t){var i,r,n,s,o,a,u,h,d,p,g,f,m;if(h=null!=e._omsData&&!e._omsData.nudged,h&&this.keepSpiderfied||("mouseover"===this.event?(i=this,r=function(){return i.unspiderfy()},window.clearTimeout(l.timeout),l.timeout=setTimeout(r,3e3)):this.unspiderfy()),h||this.map.getStreetView().getVisible()||"GoogleEarthAPI"===this.map.getMapTypeId())return this.trigger("click",e,t);for(p=[],g=[],d=this.nearbyDistance,f=d*d,u=this.llToPt(e.position),m=this.markers,n=0,s=m.length;s>n;n++)o=m[n],null!=o.map&&o.getVisible()&&(a=this.llToPt(o.position),this.ptDistanceSq(a,u)<f?p.push({marker:o,markerPt:a}):g.push(o));return 1===p.length?this.trigger("click",e,t):this.spiderfy(p,g)},l.markersNearMarker=function(e,t){var i,r,n,s,o,a,l,u,h,d,p;if(null==t&&(t=!1),null==this.projHelper.getProjection())throw"Must wait for 'idle' event on map before calling markersNearMarker";for(l=this.nearbyDistance,u=l*l,o=this.llToPt(e.position),a=[],h=this.markers,i=0,r=h.length;r>i&&(n=h[i],!(n!==e&&null!=n.map&&n.getVisible()&&(s=this.llToPt(null!=(d=null!=(p=n._omsData)?p.usualPosition:void 0)?d:n.position),this.ptDistanceSq(s,o)<u&&(a.push(n),t))));i++);return a},l.markersNearAnyOtherMarker=function(){var e,t,i,r,n,s,o,a,l,u,h,d,p,g,f,m,c,v,k,L,y;if(null==this.projHelper.getProjection())throw"Must wait for 'idle' event on map before calling markersNearAnyOtherMarker";for(m=this.nearbyDistance,c=m*m,g=function(){var e,t,i,r,n,s;for(i=this.markers,s=[],e=0,t=i.length;t>e;e++)l=i[e],s.push({pt:this.llToPt(null!=(r=null!=(n=l._omsData)?n.usualPosition:void 0)?r:l.position),willSpiderfy:!1});return s}.call(this),v=this.markers,t=r=0,s=v.length;s>r;t=++r)if(u=v[t],null!=u.map&&u.getVisible()&&(h=g[t],!h.willSpiderfy))for(k=this.markers,i=n=0,o=k.length;o>n;i=++n)if(d=k[i],i!==t&&null!=d.map&&d.getVisible()&&(p=g[i],(!(t>i)||p.willSpiderfy)&&this.ptDistanceSq(h.pt,p.pt)<c)){h.willSpiderfy=p.willSpiderfy=!0;break}for(L=this.markers,y=[],e=f=0,a=L.length;a>f;e=++f)l=L[e],g[e].willSpiderfy&&y.push(l);return y},l.makeHighlightListenerFuncs=function(e){return{highlight:function(t){return function(){var i;return e._omsData.leg.setOptions({strokeColor:t.legColors.highlighted[t.map.mapTypeId],zIndex:t.highlightedLegZIndex}),null!=e._omsData.shadow?(i=e._omsData.shadow.getIcon(),i.fillOpacity=.8,e._omsData.shadow.setOptions({icon:i})):void 0}}(this),unhighlight:function(t){return function(){var i;return e._omsData.leg.setOptions({strokeColor:t.legColors.usual[t.map.mapTypeId],zIndex:t.usualLegZIndex}),null!=e._omsData.shadow?(i=e._omsData.shadow.getIcon(),i.fillOpacity=.3,e._omsData.shadow.setOptions({icon:i})):void 0}}(this)}},l.spiderfy=function(e,i){var r,s,o,a,l,u,h,d,p,g,f,m,c;return this.minZoomLevel&&this.map.getZoom()<this.minZoomLevel?!1:(this.spiderfying=!0,m=e.length,r=this.ptAverage(function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)g=e[t],r.push(g.markerPt);return r}()),l=m>=this.circleSpiralSwitchover?this.generatePtsSpiral(m,r).reverse():this.generatePtsCircle(m,r),s=this.ptToLl(r),c=function(){var i,r,g,m,c;for(c=[],i=0,r=l.length;r>i;i++)a=l[i],o=this.ptToLl(a),f=this.minExtract(e,function(e){return function(t){return e.ptDistanceSq(t.markerPt,a)}}(this)),p=f.marker,d=this.lineToCenter?s:p.position,h=new n.Polyline({map:this.map,path:[d,o],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),p._omsData={usualPosition:null!=(g=null!=(m=p._omsData)?m.usualPosition:void 0)?g:p.position,leg:h},this.spiderfiedShadowColor&&(p._omsData.shadow=new n.Marker({position:o,map:this.map,clickable:!1,zIndex:-2,icon:{path:google.maps.SymbolPath.CIRCLE,fillOpacity:.3,fillColor:this.spiderfiedShadowColor,strokeWeight:0,scale:20}})),this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId]&&(u=this.makeHighlightListenerFuncs(p),p._omsData.hightlightListeners={highlight:t.addListener(p,"mouseover",u.highlight),unhighlight:t.addListener(p,"mouseout",u.unhighlight)}),p.setPosition(o),p.setZIndex(Math.round(this.spiderfiedZIndex+a.y)),c.push(p);return c}.call(this),delete this.spiderfying,this.spiderfied=!0,this.trigger("spiderfy",c,i))},l.unspiderfy=function(e){var i,r,n,s,o,a,l,u;if(null==e&&(e=null),null==this.spiderfied)return this;for(this.unspiderfying=!0,u=[],o=[],a=this.markers,i=0,r=a.length;r>i;i++)s=a[i],null==s._omsData||s._omsData.nudged?o.push(s):(s._omsData.leg.setMap(null),null!=(l=s._omsData.shadow)&&l.setMap(null),s!==e&&s.setPosition(s._omsData.usualPosition),s.setZIndex(null),n=s._omsData.hightlightListeners,null!=n&&(t.removeListener(n.highlight),t.removeListener(n.unhighlight)),delete s._omsData,u.push(s));return delete this.unspiderfying,delete this.spiderfied,this.trigger("unspiderfy",u,o),this.nudged&&this.nudgeAllMarkers(),this},l.ptDistanceSq=function(e,t){var i,r;return i=e.x-t.x,r=e.y-t.y,i*i+r*r},l.ptAverage=function(e){var t,i,r,s,o,a;for(o=a=0,t=0,i=e.length;i>t;t++)s=e[t],o+=s.x,a+=s.y;return r=e.length,new n.Point(o/r,a/r)},l.llToPt=function(e){return this.projHelper.getProjection().fromLatLngToDivPixel(e)},l.ptToLl=function(e){return this.projHelper.getProjection().fromDivPixelToLatLng(e)},l.minExtract=function(e,t){var i,r,n,s,o,a,l;for(n=o=0,a=e.length;a>o;n=++o)s=e[n],l=t(s),("undefined"==typeof i||null===i||r>l)&&(r=l,i=n);return e.splice(i,1)[0]},l.arrIndexOf=function(e,t){var i,r,n,s;if(null!=e.indexOf)return e.indexOf(t);for(i=r=0,n=e.length;n>r;i=++r)if(s=e[i],s===t)return i;return-1},e.ProjHelper=function(e){return this.setMap(e)},e.ProjHelper.prototype=new n.OverlayView,e.ProjHelper.prototype.draw=function(){},e}(),e.exports=this.OverlappingMarkerSpiderfier}])});