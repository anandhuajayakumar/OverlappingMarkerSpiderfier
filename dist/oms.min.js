!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.OverlappingMarkerSpiderfier=t():e.OverlappingMarkerSpiderfier=t()}(this,function(){return function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="/static/",t(0)}([function(e,t,i){e.exports=i(1)},function(e,t){/** @preserve OverlappingMarkerSpiderfier
	https://github.com/jawj/OverlappingMarkerSpiderfier
	Copyright (c) 2011 - 2013 George MacKerron
	Released under the MIT licence: http://opensource.org/licenses/mit-license
	Note: The Google Maps API v3 must be included *before* this code
	 */
var i={}.hasOwnProperty,r=[].slice;this.OverlappingMarkerSpiderfier=function(){function e(e,r){var n,s,o,a,l,h;this.map=e,null==r&&(r={});for(s in r)i.call(r,s)&&(h=r[s],this[s]=h);for(this.projHelper=new this.constructor.ProjHelper(this.map),this.initMarkerArrays(),this.listeners={},l=["click","zoom_changed","maptypeid_changed"],o=0,a=l.length;a>o;o++)n=l[o],t.addListener(this.map,n,function(e){return function(){return e.unspiderfy()}}(this));this.nudgeStackedMarkers&&t.addListenerOnce(this.map,"idle",function(e){return function(){return t.addListener(e.map,"zoom_changed",function(){return e.mapZoomChangeListener()}),e.mapZoomChangeListener()}}(this))}var t,n,s,o,a,l,h,u,p,d,g;for(u=e.prototype,p=[e,u],s=0,l=p.length;l>s;s++)g=p[s],g.VERSION="0.3.3";return n=google.maps,t=n.event,h=n.MapTypeId,d=2*Math.PI,u.keepSpiderfied=!1,u.markersWontHide=!1,u.markersWontMove=!1,u.spiderfiedShadowColor="white",u.nudgeStackedMarkers=!0,u.minNudgeZoomLevel=8,u.nudgeRadius=1,u.markerCountInBaseNudgeLevel=9,u.nudgeBucketSize=12,u.nearbyDistance=20,u.circleSpiralSwitchover=9,u.circleFootSeparation=23,u.circleStartAngle=d/12,u.spiralFootSeparation=26,u.spiralLengthStart=11,u.spiralLengthFactor=4,u.spiderfiedZIndex=1e3,u.usualLegZIndex=10,u.highlightedLegZIndex=20,u.event="click",u.minZoomLevel=!1,u.lineToCenter=!0,u.legWeight=1.5,u.legColors={usual:{},highlighted:{}},a=u.legColors.usual,o=u.legColors.highlighted,a[h.HYBRID]=a[h.SATELLITE]="#fff",o[h.HYBRID]=o[h.SATELLITE]="#f00",a[h.TERRAIN]=a[h.ROADMAP]="#444",o[h.TERRAIN]=o[h.ROADMAP]="#f00",u.initMarkerArrays=function(){return this.markers=[],this.markerListenerRefs=[]},u.addMarker=function(e){var i;return null!=e._oms?this:(e._oms=!0,i=[t.addListener(e,this.event,function(t){return function(i){return t.spiderListener(e,i)}}(this))],this.markersWontHide||i.push(t.addListener(e,"visible_changed",function(t){return function(){return t.markerChangeListener(e,!1)}}(this))),this.markersWontMove||i.push(t.addListener(e,"position_changed",function(t){return function(){return t.markerChangeListener(e,!0)}}(this))),this.markerListenerRefs.push(i),this.markers.push(e),this)},u.markerChangeListener=function(e,t){return null==e._omsData||e._omsData.nudged||!t&&e.getVisible()||null!=this.spiderfying||null!=this.unspiderfying?void 0:this.unspiderfy(t?e:null)},u.countsPerLevel=[1,1],u.levelsByCount=[],u.getCountPerNudgeLevel=function(e){return null!=this.countsPerLevel[e]?this.countsPerLevel[e]:this.countsPerLevel[e]=this.getCountPerNudgeLevel(e-1)+Math.pow(2,e-2)*this.markerCountInBaseNudgeLevel},u.getNudgeLevel=function(e){var t;if(null!=this.levelsByCount[e])return this.levelsByCount[e];for(t=0;e>=this.countsPerLevel[t];)t+1>=this.countsPerLevel.length&&this.getCountPerNudgeLevel(t+1),t++;return this.levelsByCount[e]=t-1},u.nudgeAllMarkers=function(){var e,t,i,r,n,s,o,a,l,h,u,p,g,f,c,m,v,k,y;for(u={},e=1/((1+this.nudgeBucketSize)*this.nudgeRadius),i=function(t){return function(t){return Math.floor(t.x*e)+","+Math.floor(t.y*e)}}(this),g=this.markers,k=[],r=n=0,s=g.length;s>n;r=++n){for(o=g[r],a=!1,h=this.llToPt(null!=(f=null!=(c=o._omsData)?c.usualPosition:void 0)?f:o.position),l={x:h.x,y:h.y};u.hasOwnProperty(i(h));)t=u[i(h)],u.hasOwnProperty(i(h))?u[i(h)]+=1:u[i(h)]=1,y=this.getNudgeLevel(t),p=20*this.nudgeRadius*y,h.x=l.x+Math.sin(d*t/this.markerCountInBaseNudgeLevel/y)*p,h.y=l.y+Math.cos(d*t/this.markerCountInBaseNudgeLevel/y)*p,this.nudged=!0,a=!0;a?(o._omsData={usualPosition:null!=(m=null!=(v=o._omsData)?v.usualPosition:void 0)?m:o.position,nudged:!0},o.setPosition(this.ptToLl(h))):null!=o._omsData&&o._omsData.nudged&&(o.setPosition(o._omsData.usualPosition),delete o._omsData),k.push(u.hasOwnProperty(i(h))?void 0:u[i(h)]=1)}return k},u.resetNudgedMarkers=function(){var e,t,i,r;if(this.nudged){for(r=this.markers,e=0,t=r.length;t>e;e++)i=r[e],null!=i._omsData&&i._omsData.nudged&&(i.setPosition(i._omsData.usualPosition),delete i._omsData);return delete this.nudged}},u.mapZoomChangeListener=function(){return this.minNudgeZoomLevel&&this.map.getZoom()<this.minNudgeZoomLevel?this.resetNudgedMarkers():this.nudgeAllMarkers(this.markers)},u.getMarkers=function(){return this.markers.slice(0)},u.removeMarker=function(e){var i,r,n,s,o;if(null!=e._omsData&&this.unspiderfy(),i=this.arrIndexOf(this.markers,e),0>i)return this;for(o=this.markerListenerRefs.splice(i,1)[0],r=0,n=o.length;n>r;r++)s=o[r],t.removeListener(s);return delete e._oms,this.markers.splice(i,1),this},u.clearMarkers=function(){var e,i,r,n,s,o,a,l,h;for(this.unspiderfy(),h=this.markers,e=i=0,r=h.length;r>i;e=++i){for(a=h[e],o=this.markerListenerRefs[e],l=0,n=o.length;n>l;l++)s=o[l],t.removeListener(s);delete a._oms}return this.initMarkerArrays(),this},u.addListener=function(e,t){var i;return(null!=(i=this.listeners)[e]?i[e]:i[e]=[]).push(t),this},u.removeListener=function(e,t){var i;return i=this.arrIndexOf(this.listeners[e],t),0>i||this.listeners[e].splice(i,1),this},u.clearListeners=function(e){return this.listeners[e]=[],this},u.trigger=function(){var e,t,i,n,s,o,a,l;for(t=arguments[0],e=arguments.length>=2?r.call(arguments,1):[],a=null!=(o=this.listeners[t])?o:[],l=[],n=0,s=a.length;s>n;n++)i=a[n],l.push(i.apply(null,e));return l},u.generatePtsCircle=function(e,t){var i,r,s,o,a,l,h,u;for(s=this.circleFootSeparation*(2+e),l=s/d,r=d/e,u=[],o=a=0,h=e;h>=0?h>a:a>h;o=h>=0?++a:--a)i=this.circleStartAngle+o*r,u.push(new n.Point(t.x+l*Math.cos(i),t.y+l*Math.sin(i)));return u},u.generatePtsSpiral=function(e,t){var i,r,s,o,a,l,h;for(o=this.spiralLengthStart,i=0,h=[],r=s=0,l=e;l>=0?l>s:s>l;r=l>=0?++s:--s)i+=this.spiralFootSeparation/o+5e-4*r,a=new n.Point(t.x+o*Math.cos(i),t.y+o*Math.sin(i)),o+=d*this.spiralLengthFactor/i,h.push(a);return h},u.spiderListener=function(e,t){var i,r,n,s,o,a,l,h,p,d,g,f,c;if(h=null!=e._omsData&&!e._omsData.nudged,h&&this.keepSpiderfied||("mouseover"===this.event?(i=this,r=function(){return i.unspiderfy()},window.clearTimeout(u.timeout),u.timeout=setTimeout(r,3e3)):this.unspiderfy()),h||this.map.getStreetView().getVisible()||"GoogleEarthAPI"===this.map.getMapTypeId())return this.trigger("click",e,t);for(d=[],g=[],p=this.nearbyDistance,f=p*p,l=this.llToPt(e.position),c=this.markers,n=0,s=c.length;s>n;n++)o=c[n],null!=o.map&&o.getVisible()&&(a=this.llToPt(o.position),this.ptDistanceSq(a,l)<f?d.push({marker:o,markerPt:a}):g.push(o));return 1===d.length?this.trigger("click",e,t):this.spiderfy(d,g)},u.markersNearMarker=function(e,t){var i,r,n,s,o,a,l,h,u,p,d;if(null==t&&(t=!1),null==this.projHelper.getProjection())throw"Must wait for 'idle' event on map before calling markersNearMarker";for(l=this.nearbyDistance,h=l*l,o=this.llToPt(e.position),a=[],u=this.markers,i=0,r=u.length;r>i&&(n=u[i],!(n!==e&&null!=n.map&&n.getVisible()&&(s=this.llToPt(null!=(p=null!=(d=n._omsData)?d.usualPosition:void 0)?p:n.position),this.ptDistanceSq(s,o)<h&&(a.push(n),t))));i++);return a},u.markersNearAnyOtherMarker=function(){var e,t,i,r,n,s,o,a,l,h,u,p,d,g,f,c,m,v,k,y,L;if(null==this.projHelper.getProjection())throw"Must wait for 'idle' event on map before calling markersNearAnyOtherMarker";for(f=this.nearbyDistance,c=f*f,d=function(){var e,t,i,r,n,s;for(i=this.markers,s=[],e=0,t=i.length;t>e;e++)a=i[e],s.push({pt:this.llToPt(null!=(r=null!=(n=a._omsData)?n.usualPosition:void 0)?r:a.position),willSpiderfy:!1});return s}.call(this),v=this.markers,t=r=0,n=v.length;n>r;t=++r)if(l=v[t],null!=l.map&&l.getVisible()&&(h=d[t],!h.willSpiderfy))for(k=this.markers,i=g=0,s=k.length;s>g;i=++g)if(u=k[i],i!==t&&null!=u.map&&u.getVisible()&&(p=d[i],(!(t>i)||p.willSpiderfy)&&this.ptDistanceSq(h.pt,p.pt)<c)){h.willSpiderfy=p.willSpiderfy=!0;break}for(y=this.markers,L=[],e=m=0,o=y.length;o>m;e=++m)a=y[e],d[e].willSpiderfy&&L.push(a);return L},u.makeHighlightListenerFuncs=function(e){return{highlight:function(t){return function(){var i;return e._omsData.leg.setOptions({strokeColor:t.legColors.highlighted[t.map.mapTypeId],zIndex:t.highlightedLegZIndex}),null!=e._omsData.shadow?(i=e._omsData.shadow.getIcon(),i.fillOpacity=.8,e._omsData.shadow.setOptions({icon:i})):void 0}}(this),unhighlight:function(t){return function(){var i;return e._omsData.leg.setOptions({strokeColor:t.legColors.usual[t.map.mapTypeId],zIndex:t.usualLegZIndex}),null!=e._omsData.shadow?(i=e._omsData.shadow.getIcon(),i.fillOpacity=.3,e._omsData.shadow.setOptions({icon:i})):void 0}}(this)}},u.spiderfy=function(e,i){var r,s,o,a,l,h,u,p,d,g,f,c,m;return this.minZoomLevel&&this.map.getZoom()<this.minZoomLevel?!1:(this.spiderfying=!0,c=e.length,r=this.ptAverage(function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)g=e[t],r.push(g.markerPt);return r}()),l=c>=this.circleSpiralSwitchover?this.generatePtsSpiral(c,r).reverse():this.generatePtsCircle(c,r),s=this.ptToLl(r),m=function(){var i,r,g,c,m;for(m=[],i=0,r=l.length;r>i;i++)a=l[i],o=this.ptToLl(a),f=this.minExtract(e,function(e){return function(t){return e.ptDistanceSq(t.markerPt,a)}}(this)),d=f.marker,p=this.lineToCenter?s:d.position,u=new n.Polyline({map:this.map,path:[p,o],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),d._omsData={usualPosition:null!=(g=null!=(c=d._omsData)?c.usualPosition:void 0)?g:d.position,leg:u},this.spiderfiedShadowColor&&(d._omsData.shadow=new n.Marker({position:o,map:this.map,clickable:!1,zIndex:-2,icon:{path:google.maps.SymbolPath.CIRCLE,fillOpacity:.3,fillColor:this.spiderfiedShadowColor,strokeWeight:0,scale:20}})),this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId]&&(h=this.makeHighlightListenerFuncs(d),d._omsData.hightlightListeners={highlight:t.addListener(d,"mouseover",h.highlight),unhighlight:t.addListener(d,"mouseout",h.unhighlight)}),d.setPosition(o),d.setZIndex(Math.round(this.spiderfiedZIndex+a.y)),m.push(d);return m}.call(this),delete this.spiderfying,this.spiderfied=!0,this.trigger("spiderfy",m,i))},u.unspiderfy=function(e){var i,r,n,s,o,a,l,h;if(null==e&&(e=null),null==this.spiderfied)return this;for(this.unspiderfying=!0,h=[],o=[],a=this.markers,i=0,r=a.length;r>i;i++)s=a[i],null==s._omsData||s._omsData.nudged?o.push(s):(s._omsData.leg.setMap(null),null!=(l=s._omsData.shadow)&&l.setMap(null),s!==e&&s.setPosition(s._omsData.usualPosition),s.setZIndex(null),n=s._omsData.hightlightListeners,null!=n&&(t.removeListener(n.highlight),t.removeListener(n.unhighlight)),delete s._omsData,h.push(s));return delete this.unspiderfying,delete this.spiderfied,this.trigger("unspiderfy",h,o),this.nudged&&this.nudgeAllMarkers(),this},u.ptDistanceSq=function(e,t){var i,r;return i=e.x-t.x,r=e.y-t.y,i*i+r*r},u.ptAverage=function(e){var t,i,r,s,o,a;for(o=a=0,t=0,i=e.length;i>t;t++)s=e[t],o+=s.x,a+=s.y;return r=e.length,new n.Point(o/r,a/r)},u.llToPt=function(e){return this.projHelper.getProjection().fromLatLngToDivPixel(e)},u.ptToLl=function(e){return this.projHelper.getProjection().fromDivPixelToLatLng(e)},u.minExtract=function(e,t){var i,r,n,s,o,a,l;for(n=o=0,a=e.length;a>o;n=++o)s=e[n],l=t(s),("undefined"==typeof i||null===i||r>l)&&(r=l,i=n);return e.splice(i,1)[0]},u.arrIndexOf=function(e,t){var i,r,n,s;if(null!=e.indexOf)return e.indexOf(t);for(i=r=0,n=e.length;n>r;i=++r)if(s=e[i],s===t)return i;return-1},e.ProjHelper=function(e){return this.setMap(e)},e.ProjHelper.prototype=new n.OverlayView,e.ProjHelper.prototype.draw=function(){},e}(),e.exports=this.OverlappingMarkerSpiderfier}])});